[package]
name = "vertx"
version.workspace = true
authors.workspace = true
edition.workspace = true
license.workspace = true
publish = false

[features]
log = [
    "embassy-net/log",
    "loog/log",
]
defmt = [
    "loog/defmt",
    "postcard/use-defmt",
]

backpack = [
    "dep:embedded-hal",
    "dep:embedded-hal-async",
]
backpack-boot-mode = ["backpack"]

network-native = [
    "dep:vertx-server",
]
network-backpack = [
    "backpack",
    "dep:embedded-io-async",
    "dep:vertx-backpack-ipc",
]

chip-esp = [
    "defmt",
    "network-native",
    "dep:esp-backtrace",
    "dep:esp-hal",
    "dep:esp-hal-embassy",
    "dep:esp-hal-smartled",
    "dep:esp-println",
    "dep:esp-storage",
    "dep:vertx-network-esp",
]
chip-esp32s3 = [
    "chip-esp",
    "esp-backtrace/esp32s3",
    "esp-hal/esp32s3",
    "esp-hal-embassy/esp32s3",
    "esp-hal-smartled/esp32s3",
    "esp-println/esp32s3",
    "esp-storage/esp32s3",
    "vertx-network-esp/chip-esp32s3",
]

chip-rp = [
    "defmt",
    "backpack-boot-mode",
    "network-backpack",
    "dep:cortex-m-rt",
    "dep:defmt-rtt",
    "dep:embassy-rp",
    "dep:fixed",
    "dep:fixed-macro",
    "dep:panic-probe",
    "dep:pio",
    "embassy-executor/arch-cortex-m",
    "embassy-executor/executor-thread",
    "portable-atomic/critical-section",
]
chip-rp2040 = [
    "chip-rp",
]

# chip-stm = []
# chip-stm32f407 = [
#   "chip-stm",
#   "dep:stm32f4xx-hal",
#   "stm32f4xx-hal/stm32f407",
# ]

simulator = [
    "log",
    "network-backpack",
    "dep:env_logger",
    "dep:tokio",
    "dep:vertx-simulator-ipc",
    "embassy-executor/arch-std",
    "embassy-executor/executor-thread",
    "embassy-time/std",
    "embedded-io-async/std",
    "rand/std",
    "rand/std_rng",
    "vertx-server/std",
]

[dependencies]
bytemuck = { version = "=1.16.3", features = ["min_const_generics"] }
critical-section = "=1.1.2"
embassy-executor = { workspace = true, features = ["nightly"] }
embassy-futures = { workspace = true }
embassy-net = { workspace = true, features = ["dhcpv4", "tcp", "udp", "dhcpv4-hostname"] }
embassy-sync = { workspace = true }
embassy-time = { workspace = true, features = ["generic-queue-8"] }
esp-alloc = { workspace = true }
heapless = { workspace = true }
loog = { workspace = true }
portable-atomic = { workspace = true }
postcard = { workspace = true }
rand = { version = "=0.8.5", default-features = false, features = ["min_const_gen"] }
serde = { workspace = true, features = ["derive"] }
smart-leds = "=0.4.0"
static_cell = { workspace = true, features = ["nightly"] }
vertx-config = { workspace = true, features = ["heapless"] }
vertx-network = { workspace = true }

# backpack
embedded-hal = { version = "=1.0.0", optional = true }
embedded-hal-async = { version = "=1.0.0", optional = true }
embedded-io-async = { version = "=0.6.1", optional = true }
vertx-backpack-ipc = { workspace = true, optional = true }

# network-native
vertx-server = { workspace = true, optional = true }

# chip-esp
esp-backtrace = { workspace = true, features = ["colors", "panic-handler", "exception-handler", "println"], optional = true }
esp-hal = { workspace = true, features = ["async"], optional = true }
esp-hal-embassy = { workspace = true, features = ["executors"], optional = true }
esp-hal-smartled = { workspace = true, optional = true }
esp-println = { workspace = true, features = ["defmt-espflash", "uart", "critical-section", "colors"], optional = true }
esp-storage = { version = "=0.3.0", features = ["low-level", "storage", "critical-section"], optional = true }
vertx-network-esp = { workspace = true, optional = true }

# chip-rp
# TODO: flip-link
cortex-m-rt = { version = "=0.7.3", optional = true }
defmt-rtt = { version = "=0.4.1", optional = true }
embassy-rp = { version = "=0.2.0", features = ["defmt", "critical-section-impl", "time-driver"], optional = true }
fixed = { version = "=1.28.0", optional = true }
fixed-macro = { version = "=1.2.0", optional = true }
panic-probe = { version = "=0.3.2", optional = true }
pio = { version = "=0.2.1", optional = true }

# simulator
env_logger = { version = "=0.11.5", optional = true }
tokio = { workspace = true, optional = true }
vertx-simulator-ipc = { workspace = true, optional = true }

[build-dependencies]
basic-toml = "=0.1.9"
cargo_toml = "=0.20.4"
prettyplease = "=0.2.20"
serde = { workspace = true, features = ["derive"] }

[[bin]]
name = "vertx"
required-features = ["defmt"]

[[bin]]
name = "simulator"
required-features = ["simulator"]

[lints]
workspace = true
