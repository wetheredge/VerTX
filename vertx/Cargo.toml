[package]
name = "vertx"
version.workspace = true
authors.workspace = true
edition.workspace = true
license.workspace = true
publish = false

[features]
target-esp = [
    "dep:esp-backtrace",
    "dep:esp-hal",
    "dep:esp-hal-embassy",
    "dep:esp-hal-smartled",
    "dep:esp-println",
    "dep:esp-storage",
    "dep:esp-wifi",
]
target-esp32s3 = [
    "target-esp",
    "esp-backtrace/esp32s3",
    "esp-hal/esp32s3",
    "esp-hal-embassy/esp32s3",
    "esp-hal-smartled/esp32s3",
    "esp-println/esp32s3",
    "esp-storage/esp32s3",
    "esp-wifi/esp32s3",
]

target-hosted = [
    "dep:embassy-net-tuntap",
    "dep:env_logger",
    "dep:rand",
    "dep:vertx-simulator-ipc",
    "embassy-executor/arch-std",
    "embassy-executor/executor-thread",
    "embassy-net/std",
    "embassy-time/std",
    "picoserve/std",
]

[dependencies]
bytemuck = { version = "=1.16.3", features = ["min_const_generics"] }
critical-section = "=1.1.2"
edge-dhcp = "0.2.0"
embassy-executor = { version = "0.5.0", features = ["nightly"] }
embassy-futures = "0.1.1"
embassy-net = { workspace = true, features = ["dhcpv4", "log", "tcp", "udp", "dhcpv4-hostname"] }
embassy-sync = { workspace = true }
embassy-time = { version = "=0.3.1", features = ["generic-queue-8"] }
esp-alloc = "=0.4.0"
heapless = { workspace = true }
log = { version = "=0.4.22" }
picoserve = { workspace = true, features = ["embassy"] }
portable-atomic = { version = "=1.7.0", default-features = false }
postcard = { workspace = true }
serde = { workspace = true, features = ["derive"] }
smart-leds = "0.4.0"
static_cell = { version = "2.1.0", features = ["nightly"] }
vertx-config = { workspace = true, features = ["heapless"] }

# target-esp
esp-backtrace = { version = "=0.13.0", features = ["colors", "panic-handler", "exception-handler", "println"], optional = true }
esp-hal = { version = "=0.19.0", features = ["async"], optional = true }
esp-hal-embassy = { version = "=0.2.0", default-features = false, optional = true }
esp-hal-smartled = { version = "=0.12.0", optional = true }
esp-println = { version = "=0.10.0", default-features = false, features = ["log", "uart", "critical-section", "colors"], optional = true }
esp-storage = { version = "=0.3.0", default-features = false, features = ["low-level", "storage", "critical-section"], optional = true }
esp-wifi = { version = "=0.7.1", features = ["wifi", "embassy-net"], optional = true }

# target-hosted
embassy-net-tuntap = { version = "=0.1.0", optional = true }
env_logger = { version = "=0.11.5", optional = true }
rand = { version = "=0.8.5", optional = true }
vertx-simulator-ipc = { workspace = true, optional = true }

[build-dependencies]
basic-toml = "=0.1.9"
cargo_toml = "=0.20.4"
prettyplease = "=0.2.20"
quote = "1.0.36"
serde = { workspace = true, features = ["derive"] }
serde_json = "=1.0.122"
syn = { workspace = true, features = ["parsing"] }

[[bin]]
name = "hosted"
required-features = ["target-hosted"]

[lints]
workspace = true
